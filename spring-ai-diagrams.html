<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring AI 다이어그램</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        h2 {
            color: #555;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        .diagram-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .mermaid {
            text-align: center;
        }
        .description {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .description h3 {
            margin-top: 0;
            color: #667eea;
        }
        .description p {
            color: #666;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 Spring AI 멀티 모델 애플리케이션</h1>
        
        <h2>📋 클래스 다이어그램</h2>
        <div class="description">
            <h3>구조 설명</h3>
            <p>이 클래스 다이어그램은 애플리케이션의 정적 구조를 보여줍니다. ChatService가 중심이 되어 세 가지 AI API와 상호작용하며, Spring AI 프레임워크의 다양한 컴포넌트들을 활용합니다.</p>
        </div>
        <div class="diagram-container">
            <div class="mermaid">
classDiagram
    class Springai2Application {
        +main(String[] args) void
    }
    
    class ChatService {
        -OpenAiApi openAiApi
        -AnthropicApi anthropicApi
        -OpenAiApi geminiApi
        +ChatService(OpenAiApi, AnthropicApi, OpenAiApi)
        +getOpenAiResponse(String, double) ChatResponse
        +getAnthropicResponse(String, double) ChatResponse
        +getGeminiResponse(String, double) ChatResponse
    }
    
    class OpenAiApi {
        -String apiKey
        -String baseUrl
        -String completionsPath
        +builder() Builder
        +build() OpenAiApi
    }
    
    class AnthropicApi {
        -String apiKey
        +builder() Builder
        +build() AnthropicApi
    }
    
    class Message {
        &lt;&lt;interface&gt;&gt;
        +getContent() String
    }
    
    class SystemMessage {
        -String content
        +SystemMessage(String)
        +getContent() String
    }
    
    class UserMessage {
        -String content
        +UserMessage(String)
        +getContent() String
    }
    
    class ChatOptions {
        -String model
        -double temperature
        +builder() Builder
        +build() ChatOptions
    }
    
    class Prompt {
        -List~Message~ messages
        -ChatOptions chatOptions
        +Prompt(List~Message~, ChatOptions)
        +getMessages() List~Message~
        +getOptions() ChatOptions
    }
    
    class OpenAiChatModel {
        -OpenAiApi openAiApi
        +builder() Builder
        +build() OpenAiChatModel
        +call(Prompt) ChatResponse
    }
    
    class AnthropicChatModel {
        -AnthropicApi anthropicApi
        +builder() Builder
        +build() AnthropicChatModel
        +call(Prompt) ChatResponse
    }
    
    class ChatResponse {
        -Result result
        +getResult() Result
        +toString() String
    }
    
    Springai2Application ..> ChatService : creates
    Springai2Application ..> OpenAiApi : creates
    Springai2Application ..> AnthropicApi : creates
    
    ChatService o-- OpenAiApi : has
    ChatService o-- AnthropicApi : has
    
    ChatService ..> OpenAiChatModel : creates
    ChatService ..> AnthropicChatModel : creates
    ChatService ..> Prompt : creates
    ChatService ..> SystemMessage : creates
    ChatService ..> UserMessage : creates
    ChatService ..> ChatOptions : creates
    
    SystemMessage ..|> Message : implements
    UserMessage ..|> Message : implements
    
    Prompt o-- Message : contains
    Prompt o-- ChatOptions : contains
    
    OpenAiChatModel --> OpenAiApi : uses
    AnthropicChatModel --> AnthropicApi : uses
    
    OpenAiChatModel ..> ChatResponse : returns
    AnthropicChatModel ..> ChatResponse : returns
            </div>
        </div>

        <h2>🔄 시퀀스 다이어그램</h2>
        <div class="description">
            <h3>실행 흐름 설명</h3>
            <p>이 시퀀스 다이어그램은 애플리케이션이 시작되어 각 AI 모델을 호출하는 전체 흐름을 시간 순서대로 보여줍니다. 동일한 질문이 세 가지 다른 AI 서비스로 전송되고 응답을 받는 과정을 확인할 수 있습니다.</p>
        </div>
        <div class="diagram-container">
            <div class="mermaid">
sequenceDiagram
    participant Main as Springai2Application
    participant CS as ChatService
    participant OAI as OpenAiApi
    participant AAI as AnthropicApi
    participant GAI as GeminiApi
    participant OCM as OpenAiChatModel
    participant ACM as AnthropicChatModel
    participant GCM as GeminiChatModel
    
    Main->>Main: 환경변수에서 API 키 가져오기
    Note over Main: OPENAI_API_KEY<br/>ANTHROPIC_API_KEY<br/>GEMINI_API_KEY
    
    Main->>OAI: OpenAiApi 생성 (openAiApiKey)
    Main->>AAI: AnthropicApi 생성 (anthropicApiKey)
    Main->>GAI: OpenAiApi 생성 (geminiApiKey, Google URL)
    
    Main->>CS: new ChatService(openAiApi, anthropicApi, geminiApi)
    
    rect rgb(200, 230, 255)
        Note over Main,OCM: OpenAI 호출 프로세스
        Main->>CS: getOpenAiResponse("AI에 대해서 설명해줘", 0.5)
        CS->>CS: SystemMessage 생성
        CS->>CS: UserMessage 생성
        CS->>CS: ChatOptions 생성 (model: "gpt-4o")
        CS->>CS: Prompt 생성
        CS->>OCM: OpenAiChatModel 생성
        CS->>OCM: call(prompt)
        OCM->>OAI: API 호출
        OAI-->>OCM: 응답
        OCM-->>CS: ChatResponse
        CS-->>Main: ChatResponse
        Main->>Main: OpenAI 응답 출력
    end
    
    rect rgb(255, 230, 200)
        Note over Main,ACM: Anthropic 호출 프로세스
        Main->>CS: getAnthropicResponse("AI에 대해서 설명해줘", 0.5)
        CS->>CS: SystemMessage 생성
        CS->>CS: UserMessage 생성
        CS->>CS: ChatOptions 생성 (model: "claude-3-7-sonnet")
        CS->>CS: Prompt 생성
        CS->>ACM: AnthropicChatModel 생성
        CS->>ACM: call(prompt)
        ACM->>AAI: API 호출
        AAI-->>ACM: 응답
        ACM-->>CS: ChatResponse
        CS-->>Main: ChatResponse
        Main->>Main: Anthropic 응답 출력
    end
    
    rect rgb(230, 255, 200)
        Note over Main,GCM: Gemini 호출 프로세스
        Main->>CS: getGeminiResponse("AI에 대해서 설명해줘", 0.5)
        CS->>CS: SystemMessage 생성
        CS->>CS: UserMessage 생성
        CS->>CS: ChatOptions 생성 (model: "gemini-2.0-flash-lite")
        CS->>CS: Prompt 생성
        CS->>GCM: OpenAiChatModel 생성 (Gemini용)
        CS->>GCM: call(prompt)
        GCM->>GAI: API 호출
        GAI-->>GCM: 응답
        GCM-->>CS: ChatResponse
        CS-->>Main: ChatResponse
        Main->>Main: Gemini 응답 출력
    end
            </div>
        </div>

        <div class="description">
            <h3>💡 주요 특징</h3>
            <p><strong>1. 통합 인터페이스:</strong> ChatService가 세 가지 AI 서비스에 대한 통합 인터페이스 역할을 합니다.</p>
            <p><strong>2. 빌더 패턴:</strong> 모든 API와 Model 클래스는 빌더 패턴을 사용하여 객체를 생성합니다.</p>
            <p><strong>3. 재사용성:</strong> Message, ChatOptions, Prompt 등의 컴포넌트가 모든 AI 서비스에서 재사용됩니다.</p>
            <p><strong>4. OpenAI 호환성:</strong> Gemini API가 OpenAI 호환 엔드포인트를 제공하여 OpenAiApi 클래스를 재사용합니다.</p>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#fff',
                primaryBorderColor: '#7c3aed',
                lineColor: '#5a67d8',
                secondaryColor: '#e0e7ff',
                tertiaryColor: '#faf5ff',
                background: '#ffffff',
                mainBkg: '#667eea',
                secondBkg: '#e0e7ff',
                tertiaryBkg: '#faf5ff',
                noteBkgColor: '#fff5e6',
                noteTextColor: '#333333',
                noteBorderColor: '#ffa500'
            }
        });
    </script>
</body>
</html>